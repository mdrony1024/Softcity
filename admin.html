<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1e21; display: flex; }
        .sidebar { width: 220px; background: #fff; height: 100vh; position: fixed; box-shadow: 2px 0 5px rgba(0,0,0,0.1); padding-top: 20px; }
        .sidebar h2 { text-align: center; color: #1c1e21; margin-bottom: 30px; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar ul li a { display: block; padding: 15px 20px; color: #333; text-decoration: none; font-weight: 500; border-left: 3px solid transparent; }
        .sidebar ul li a.active, .sidebar ul li a:hover { background: #f0f2f5; color: #1877f2; border-left-color: #1877f2; }
        .main-content { margin-left: 220px; padding: 20px; width: calc(100% - 220px); }
        .container { max-width: 1200px; margin: auto; }
        #login-view { display: block; max-width: 400px; margin: 100px auto; padding: 20px; }
        #admin-view { display: none; }
        .admin-page { display: none; animation: fadeIn 0.5s; }
        .admin-page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); }
        h1, h2, h3 { color: #1c1e21; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; vertical-align: middle; word-break: break-all; }
        th { background-color: #f5f6f7; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-approve { background-color: #42b72a; color: white; }
        .btn-reject { background-color: #fa3e3e; color: white; }
        .btn-edit { background-color: #1877f2; color: white; }
        .btn-save { background-color: #f5a623; color: white; }
        .btn-delete { background-color: #e02828; color: white; }
        .btn-add { background-color: #36a420; color: white; margin-top: 10px; }
        input[type="text"], input[type="password"], input[type="number"], select, textarea { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .actions-cell { display: flex; gap: 5px; flex-wrap: wrap;}
        .setting-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .setting-item { margin-bottom: 15px; }
        .method-item { display: grid; grid-template-columns: 1fr 120px 80px; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #eee; border-radius: 6px; }
        .shop-item-settings { border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-top: 15px; }
    </style>
</head>
<body>

    <div id="login-view">
        <div class="card">
            <h1>Admin Login</h1>
            <input type="text" id="username-input" placeholder="Username">
            <input type="password" id="password-input" placeholder="Password">
            <button id="login-btn" class="btn btn-edit" style="width: 100%;">Login</button>
        </div>
    </div>

    <div id="admin-view">
        <aside class="sidebar">
            <h2>Softcity Admin</h2>
            <ul>
                <li><a href="#settings" class="nav-link active">App Settings</a></li>
                <li><a href="#notice" class="nav-link">Notice</a></li>
                <li><a href="#shop-orders" class="nav-link">Shop Orders</a></li>
                <li><a href="#users" class="nav-link">Users</a></li>
                <li><a href="#withdrawals" class="nav-link">Withdrawals</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="container">
                <!-- Settings Page -->
                <div id="settings" class="admin-page active">
                    <div class="card">
                        <h2>App Settings</h2>
                        <div class="setting-grid">
                            <div class="setting-item"><label>App Name</label><input type="text" id="app-name-input"></div>
                            <div class="setting-item"><label>Bot Username (without @)</label><input type="text" id="bot-username-input"></div>
                            <div class="setting-item"><label>Points Per Ad</label><input type="number" id="points-per-ad-input"></div>
                            <div class="setting-item"><label>Daily Ad Limit</label><input type="number" id="daily-ad-limit-input"></div>
                            <div class="setting-item"><label>Referral Commission (%)</label><input type="number" id="referral-commission-input"></div>
                            <div class="setting-item"><label>Join Channel URL</label><input type="text" id="join-channel-url-input"></div>
                        </div>
                        <hr>
                        <h3>Withdrawal Settings</h3>
                        <div class="setting-grid">
                            <div class="setting-item"><label>Min Withdraw</label><input type="number" id="min-withdraw-input"></div>
                            <div class="setting-item"><label>Max Withdraw</label><input type="number" id="max-withdraw-input"></div>
                            <div class="setting-item"><label>Enabled</label><select id="withdraw-enabled-select"><option value="true">Yes</option><option value="false">No</option></select></div>
                            <div class="setting-item"><label>Admin WhatsApp Group URL</label><input type="text" id="whatsapp-url-input"></div>
                        </div>
                        <h4>Withdrawal Methods</h4>
                        <div id="withdrawal-methods-container"></div>
                        <button id="add-method-btn" class="btn btn-add">Add New Method</button>
                        <hr>
                        <h3>Daily Check-in Bonus Points</h3>
                        <div id="daily-bonus-container" class="setting-grid"></div>
                        <hr>
                        <h3>Shop Item Settings</h3>
                        <div id="shop-items-container"></div>
                        <hr style="margin-top: 20px;">
                        <button id="save-settings-btn" class="btn btn-save" style="width: 100%;">Save All Settings</button>
                    </div>
                </div>

                <!-- Notice Page -->
                <div id="notice" class="admin-page">
                    <div class="card">
                        <h2>Send Notice to All Users</h2>
                        <textarea id="notice-input" rows="4" placeholder="Enter notice..."></textarea>
                        <button id="send-notice-btn" class="btn btn-edit">Send Notice</button>
                        <button id="remove-notice-btn" class="btn btn-reject">Remove Notice</button>
                    </div>
                </div>

                <!-- Shop Orders Page -->
                <div id="shop-orders" class="admin-page">
                    <div class="card">
                        <h2>Pending Shop Orders</h2>
                        <table id="purchases-table">
                            <thead><tr><th>Date</th><th>User</th><th>Item</th><th>Link</th><th>Cost</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Users Page -->
                <div id="users" class="admin-page">
                     <div class="card">
                        <h2>Manage Users</h2>
                        <input type="text" id="search-user-input" placeholder="Search by User ID or Name...">
                        <table id="users-table">
                            <thead><tr><th>User ID</th><th>Name</th><th>Points</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Withdrawals Page -->
                <div id="withdrawals" class="admin-page">
                    <div class="card">
                        <h2>Pending Withdrawals</h2>
                        <table id="withdrawals-table">
                            <thead><tr><th>Date</th><th>User</th><th>Amount</th><th>Method</th><th>Account</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- Firebase Config & Global Vars ---
        const firebaseConfig = { apiKey: "AIzaSyDVNsMeB1jzOcIqAJjryUYmipT_SKrJi9k", authDomain: "giveawaybd.firebaseapp.com", databaseURL: "https://giveawaybd-default-rtdb.firebaseio.com", projectId: "giveawaybd" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let currentSettings = {}, allUsersData = {};
        
        // --- Navigation Logic ---
        const navLinks = document.querySelectorAll('.nav-link');
        const adminPages = document.querySelectorAll('.admin-page');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                navLinks.forEach(l => l.classList.remove('active'));
                adminPages.forEach(p => p.classList.remove('active'));
                link.classList.add('active');
                document.getElementById(targetId).classList.add('active');
            });
        });

        // --- Login Logic ---
        document.getElementById('login-btn').addEventListener('click', () => {
            const userVal = document.getElementById('username-input').value;
            const passVal = document.getElementById('password-input').value;
            db.ref('settings/adminAuth').once('value', (snapshot) => {
                if (snapshot.exists() && userVal === snapshot.val().user && passVal === snapshot.val().pass) {
                    document.getElementById('login-view').style.display = 'none';
                    document.getElementById('admin-view').style.display = 'flex';
                    loadInitialData();
                } else {
                    alert('Wrong credentials!');
                }
            });
        });
        
        function loadInitialData() {
            loadSettings(); loadWithdrawals(); loadPurchases(); loadUsers();
        }

        // --- Settings Logic ---
        const settingsInputs = {
            appName: document.getElementById('app-name-input'), botUsername: document.getElementById('bot-username-input'),
            pointsPerAd: document.getElementById('points-per-ad-input'), dailyAdLimit: document.getElementById('daily-ad-limit-input'),
            referralCommission: document.getElementById('referral-commission-input'), joinChannelUrl: document.getElementById('join-channel-url-input'),
            minWithdraw: document.getElementById('min-withdraw-input'), maxWithdraw: document.getElementById('max-withdraw-input'),
            isWithdrawEnabled: document.getElementById('withdraw-enabled-select'), adminWhatsappGroupUrl: document.getElementById('whatsapp-url-input'),
        };

        function loadSettings() {
             db.ref('settings').on('value', (snapshot) => {
                if (!snapshot.exists()) return;
                currentSettings = snapshot.val();
                
                for(const key in settingsInputs) {
                    if (key === 'isWithdrawEnabled') {
                        settingsInputs[key].value = currentSettings[key] !== undefined ? currentSettings[key].toString() : 'true';
                    } else {
                        settingsInputs[key].value = currentSettings[key] || '';
                    }
                }
                
                // Load dynamic sections
                renderWithdrawalMethods(currentSettings.withdrawalMethods);
                renderDailyBonus(currentSettings.dailyBonusPoints);
                renderShopItems(currentSettings.shopItems);
            });
        }
        
        // Dynamic UI renderers
        function renderWithdrawalMethods(methods) { /* ... same as before ... */ }
        function addMethodUI(key, name = '', enabled = true) { /* ... same as before ... */ }
        document.getElementById('add-method-btn').addEventListener('click', () => addMethodUI(`method_${Date.now()}`));

        function renderDailyBonus(points) {
            const container = document.getElementById('daily-bonus-container'); container.innerHTML = '';
            const bonusPoints = points || [1,2,4,10,15,17,20];
            for (let i=0; i<7; i++) container.innerHTML += `<div class="setting-item"><label>Day ${i+1}</label><input type="number" class="daily-bonus-input" value="${bonusPoints[i] || 0}"></div>`;
        }
        function renderShopItems(items) {
            const container = document.getElementById('shop-items-container'); container.innerHTML = '';
            const shopItems = items || { members: { name: 'Telegram Members', price: 100, min: 10, max: 1000 } };
            for(const key in shopItems) {
                const item = shopItems[key];
                container.innerHTML += `<div class="shop-item-settings" data-key="${key}"><h4>${item.name}</h4><div class="setting-grid">
                    <div class="setting-item"><label>Price (per item)</label><input type="number" class="shop-price" value="${item.price}"></div>
                    <div class="setting-item"><label>Min Quantity</label><input type="number" class="shop-min" value="${item.min}"></div>
                    <div class="setting-item"><label>Max Quantity</label><input type="number" class="shop-max" value="${item.max}"></div>
                </div></div>`;
            }
        }

        // Save settings button
        document.getElementById('save-settings-btn').addEventListener('click', () => {
            let updates = {};
            for(const key in settingsInputs) {
                updates[key] = (settingsInputs[key].type === 'number') ? parseInt(settingsInputs[key].value, 10) : (key === 'isWithdrawEnabled' ? (settingsInputs[key].value === 'true') : settingsInputs[key].value);
            }
            updates.withdrawalMethods = {}; /* ... same as before ... */
            updates.dailyBonusPoints = Array.from(document.querySelectorAll('.daily-bonus-input')).map(i => parseInt(i.value, 10));
            updates.shopItems = {};
            document.querySelectorAll('.shop-item-settings').forEach(item => {
                const key = item.dataset.key;
                updates.shopItems[key] = {
                    name: item.querySelector('h4').textContent,
                    price: parseInt(item.querySelector('.shop-price').value, 10),
                    min: parseInt(item.querySelector('.shop-min').value, 10),
                    max: parseInt(item.querySelector('.shop-max').value, 10),
                };
            });
            db.ref('settings').update(updates).then(() => alert('Settings saved!'));
        });

        // --- Other Sections (Notice, Purchases, Withdrawals, Users) ---
        // These are mostly the same, just attached to their respective page IDs
        function loadPurchases() { /* ... same code as before ... */ }
        window.handleShopOrder = (key, action) => { /* ... same code as before ... */ }
        function loadWithdrawals() { /* ... same code as before ... */ }
        window.handleWithdrawal = (key, action) => { /* ... same code as before ... */ }
        function loadUsers() { /* ... same code as before ... */ }
        window.editPoints = (userId, name) => { /* ... same code as before ... */ }
        // Notice logic is the same...
    </script>
</body>
</html>
