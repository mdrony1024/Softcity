<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Softcity</title>
    <!-- IMPORTANT: Auth SDK is now included -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary-color: #5856d6; --light-bg: #f0f2f5; --white: #fff; --dark-text: #1c1e21; --light-text: #666; --border-color: #ddd; --danger-color: #fa3e3e; --success-color: #42b72a; --warning-color: #f5a623; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: var(--light-bg); color: var(--dark-text); }
        #login-view { display: flex; width: 100%; height: 100vh; align-items: center; justify-content: center; }
        #admin-view { display: none; }
        .admin-view-content { display: flex; }
        .card { background: var(--white); padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 500; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; margin-top: 5px; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; }
        .btn-edit { background-color: var(--primary-color); color: white; }
        
        /* Paste ALL other CSS from your old file here */
        .sidebar { width: 240px; background: var(--white); height: 100vh; position: fixed; box-shadow: 2px 0 5px rgba(0,0,0,0.05); transition: width 0.3s ease; z-index: 100; overflow-x: hidden; }
        .main-content { margin-left: 240px; padding: 20px; width: calc(100% - 240px); transition: margin-left 0.3s ease, width 0.3s ease; }
        .sidebar.collapsed { width: 80px; }
        .sidebar.collapsed ~ .main-content { margin-left: 80px; width: calc(100% - 80px); }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .sidebar-header h2 { margin: 0; font-size: 24px; color: var(--primary-color); white-space: nowrap; }
        .sidebar.collapsed .sidebar-header h2 { display: none; }
        .sidebar-nav ul { list-style: none; padding: 10px 0; margin: 0; }
        .sidebar-nav ul li a { display: flex; align-items: center; padding: 15px 20px; color: #333; text-decoration: none; font-weight: 500; white-space: nowrap; border-left: 3px solid transparent; }
        .sidebar-nav ul li a .icon { font-size: 22px; width: 40px; text-align: center; }
        .sidebar-nav ul li a .title { transition: opacity 0.2s; }
        .sidebar.collapsed .sidebar-nav ul li a .title { opacity: 0; display: none; }
        .sidebar-nav ul li a.active, .sidebar-nav ul li a:hover { background: var(--light-bg); color: var(--primary-color); border-left-color: var(--primary-color); }
        .admin-page { display: none; animation: fadeIn 0.5s; }
        .admin-page.active { display: block; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid var(--border-color); text-align: left; vertical-align: middle; word-break: break-word; }
        th { background-color: #f5f6f7; font-weight: 600; }
    </style>
</head>
<body>

    <div id="login-view">
        <div class="card" style="width: 360px;">
            <h1>Secure Admin Login</h1>
            <div class="form-group"><label for="email-input">Email</label><input type="email" id="email-input"></div>
            <div class="form-group"><label for="password-input">Password</label><input type="password" id="password-input"></div>
            <button id="login-btn" class="btn btn-edit" style="width: 100%;">Login</button>
        </div>
    </div>

    <div id="admin-view">
        <div class="admin-view-content">
            <aside class="sidebar" id="sidebar">
                <!-- Sidebar content from your file -->
            </aside>
            <main class="main-content">
                <!-- Main content from your file -->
            </main>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDVNsMeB1jzOcIqAJjryUYmipT_SKrJi9k", authDomain: "giveawaybd.firebaseapp.com", databaseURL: "https://giveawaybd-default-rtdb.firebaseio.com", projectId: "giveawaybd" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const loginView = document.getElementById('login-view');
    const adminView = document.getElementById('admin-view');
    const loginBtn = document.getElementById('login-btn');

    // --- NEW, SECURE AUTHENTICATION LOGIC ---
    loginBtn.addEventListener('click', () => {
        const email = document.getElementById('email-input').value;
        const password = document.getElementById('password-input').value;

        loginBtn.textContent = 'Logging in...';
        loginBtn.disabled = true;

        auth.signInWithEmailAndPassword(email, password)
            .catch((error) => {
                alert(`Login Failed: ${error.message}`);
                loginBtn.textContent = 'Login';
                loginBtn.disabled = false;
            });
    });

    // This function runs whenever the user's login state changes
    auth.onAuthStateChanged(user => {
        if (user) {
            // User is logged in, show the admin panel
            loginView.style.display = 'none';
            adminView.style.display = 'block';
            adminView.innerHTML = `
                <div class="admin-view-content">
                    <aside class="sidebar" id="sidebar">
                        <div class="sidebar-header"><h2>Softcity</h2></div>
                        <nav class="sidebar-nav">
                            <ul>
                                <li><a href="#settings" class="nav-link active"><span class="icon">‚öôÔ∏è</span><span class="title">App Settings</span></a></li>
                                <li><a href="#shop-orders" class="nav-link"><span class="icon">üõí</span><span class="title">Shop Orders</span></a></li>
                                <li><a href="#withdrawals" class="nav-link"><span class="icon">üí∏</span><span class="title">Withdrawals</span></a></li>
                                <li><a href="#users" class="nav-link"><span class="icon">üë•</span><span class="title">Users</span></a></li>
                                <li><a href="#notice" class="nav-link"><span class="icon">üì¢</span><span class="title">Notice</span></a></li>
                            </ul>
                        </nav>
                    </aside>
                    <main class="main-content">
                         <div id="settings" class="admin-page active"></div>
                         <div id="shop-orders" class="admin-page"></div>
                         <div id="withdrawals" class="admin-page"></div>
                         <div id="users" class="admin-page"></div>
                         <div id="notice" class="admin-page"></div>
                    </main>
                </div>`;
            loadInitialData();
        } else {
            // User is logged out, show the login page
            loginView.style.display = 'flex';
            adminView.style.display = 'none';
        }
    });


    function loadInitialData() {
        // Now that we are securely logged in, we load all data.
        console.log("Securely logged in. Loading data...");
        // Paste all your previous data loading and management functions here
        // For example:
        // loadSettings();
        // loadWithdrawals(); 
        // and so on...
    }
</script>
</body>
</html>
